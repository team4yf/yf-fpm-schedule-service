<!DOCTYPE html>
<html ng-app="app">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/lib/admin-lte/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
          folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="/lib/admin-lte/css/skins/_all-skins.min.css">
  </head>
  <body ng-controller="RootCtrl" class="hold-transition skin-blue layout-top-nav">
    {% raw %}
    <div class="wrapper" >

      <header class="main-header">
        <nav class="navbar navbar-static-top">
          <div class="container">
            <div class="navbar-header">
              <a class="navbar-brand"><b>Schedule Job Manager</b></a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
              <ul class="nav navbar-nav">
                <li class="active"><a href="#">Jobs <span class="sr-only">(current)</span></a></li>
                <li><a href="#">Tasks</a></li>
              </ul>
            </div>
          </div>
        </nav>
      </header>
      <!-- Full Width Column -->
      <div class="content-wrapper">
        <div class="container">
          <!-- Content Header (Page header) -->
          <section class="content-header">
            <h1>
              Jobs
              <small></small>
              <button class="btn btn-flat btn-sm bg-purple" data-toggle="modal" data-target="#modal-default"><i class="fa fa-plus"></i></button>
            </h1>
<!--             
            <ol class="breadcrumb">
              <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
              <li><a href="#">Layout</a></li>
              <li class="active">Top Navigation</li>
            </ol> -->
          </section>
    
          <!-- Main content -->
          <section class="content">
            <!-- <div class="callout callout-info">
              <h4>Tip!</h4>
    
              <p>Add the layout-top-nav class to the body tag to get this layout. This feature can also be used with a
                sidebar! So use this class if you want to remove the custom dropdown menus from the navbar and use regular
                links instead.</p>
            </div>
            <div class="callout callout-danger">
              <h4>Warning!</h4>
    
              <p>The construction of this layout differs from the normal one. In other words, the HTML markup of the navbar
                and the content will slightly differ than that of the normal layout.</p>
            </div> -->
            <div class="box box-primary box-default">
              <div class="box-header with-border">
                <h3 class="box-title">List</h3>
                <div class="box-tools">
                  <div class="input-group input-group-sm" style="width: 150px;">
                    <input type="text" name="table_search" class="form-control pull-right" placeholder="Search">
  
                    <div class="input-group-btn">
                      <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="box-body table-responsive no-padding">
                <table class="table table-hover">
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Job Type</th>
                    <th>Cron</th>
                    <th>Autorun</th>
                    <th>Method</th>
                    <th>-</th>
                  </tr>
                  <tr ng-repeat="job in jobs">
                    <td ng-bind="job.id">1</td>
                    <td ng-bind="job.name">demo</td>
                    <td><span class="label label-default" ng-bind="job.job_type"></span></td>
                    <td ng-bind="job.cron"></td>
                    <td><span ng-if="job.autorun == 1" class="text-green"><i class="fa fa-check"></i></span>
                      <span ng-if="job.autorun == 0" class="text-red"><i class="fa fa-close"></i></span></td>
                    <td ng-bind="job.method">demo.foo</td>
                    <td>
                      <button ng-if="job.autorun == 0" class="btn btn-flat btn-xs bg-olive"><i class="fa fa-play"></i></button>
                      <button ng-if="job.autorun == 1" class="btn btn-flat btn-xs bg-maroon"><i class="fa fa-pause"></i></button>
                    </td>
                  </tr>
                </table>
              </div>
              <!-- /.box-body -->
            </div>
            <!-- /.box -->
          </section>
          <!-- /.content -->
        </div>
        <!-- /.container -->
      </div>
      <div class="modal" id="modal-default">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title">Create Job</h4>
            </div>
            <div class="modal-body">
              <form role="form">
                <!-- text input -->
                <div class="form-group">
                  <label>Name</label>
                  <input type="text" class="form-control" ng-model="schedule.name" placeholder="Type the Schedule's Name">
                </div>

                <div class="form-group">
                  <label>Cron</label>
                  <input type="text" class="form-control" ng-model="schedule.cron" placeholder="Type the Schedule's Cron">
                  <span class="help-block">The CRON manual: <a href="https://github.com/node-schedule/node-schedule#jobs-and-scheduling" target="_blank">Click Me</a></span>
                </div>

                <div class="row">
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label>Autorun</label>
                      <div class="radio">
                        <label>
                          <input type="radio" name="autorun" value="1" checked="">
                          YES
                        </label>
                      </div>
                      <div class="radio">
                        <label>
                          <input type="radio" name="autorun" value="0">
                          NO
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label>Type</label>
                      <div class="radio">
                        <label>
                          <input type="radio" name="type" value="option1" checked="">
                          BIZ
                        </label>
                      </div>
                      <div class="radio">
                        <label>
                          <input type="radio" name="type" value="option3">
                          WEB
                        </label>
                      </div>
                    </div>

                  </div>
                </div>
              
                <div class="form-group">
                  <label>Method</label>
                  <input type="text" class="form-control" ng-model="schedule.method" placeholder="Type the Schedule's Method">
                </div>

                <div class="form-group">
                  <label>Version</label>
                  <input type="text" class="form-control" ng-model="schedule.v" placeholder="Type the Schedule's Version">
                </div>

                <div class="form-group">
                  <label>Argument</label>
                  <textarea class="form-control" rows="3" ng-model="schedule.args" placeholder=""></textarea>
                </div>

                <!-- textarea -->
                <div class="form-group">
                  <label>Webhook</label>
                  <textarea class="form-control" rows="3" ng-model="schedule.webhook" placeholder=""></textarea>
                  <span class="help-block">Only support POST the JSON webhook!<br/>

                      You can add the webhook address when you create the schedule, it will be called after the job finished!<br/>
                      
                      the arguments of the webhook should like `{ code: 0/-1, content: {}}`</span>
                </div>

              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default btn-flat btn-sm pull-left" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-flat btn-sm btn-primary">Save</button>
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>
      <!-- /.modal -->
      
      <!-- /.content-wrapper -->
      <footer class="main-footer">
        <div class="container">
          <div class="pull-right hidden-xs">
            <b>Version</b> 2.4.0
          </div>
          <strong>Copyright &copy; 2014-2016 <a href="https://adminlte.io">Almsaeed Studio</a>.</strong> All rights
          reserved.
        </div>
        <!-- /.container -->
      </footer>
    </div>
    <!-- ./wrapper -->
    {% endraw %}
    <!-- jQuery 3 -->
  <script src="/lib/jquery/jquery.min.js"></script>
  <!-- Bootstrap 3.3.7 -->
  <script src="/lib/bootstrap/js/bootstrap.min.js"></script>
  <!-- FastClick -->
  <script src="/lib/fastclick/fastclick.js"></script>
  <!-- angular -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.7.2/angular.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"></script>
  <script src="/lib/sweetalert2/sweetalert2.all.min.js"></script>
  <script src="/lib/fpmc-jssdk/fpmc-latest.min.js"></script>
  <!-- AdminLTE App -->
  <script src="/lib/admin-lte/js/adminlte.min.js"></script>
  <script>
  fpmc.init({ endpoint: '/api', appkey:'123123', masterKey:'123123'});
  const app = angular.module('app', [])
    .controller('RootCtrl', ['$rootScope', '$scope',
    function($rootScope, $scope, ){
      $scope.jobs = [];
      $scope.schedule = {
        v: '0.0.1',
        cron: '* * * * *',
        args: '{}',


      }
      const { Func } = fpmc;
      new Func('job.getJobs').invoke()
        .then(data => {
          $scope.jobs = data;
          $scope.$apply();
        })
      
    }]);
  </script>
  </body>
</html>